<script lang="ts">
import * as Card from "$lib/components/ui/card/index.ts";
import * as Carousel from "$lib/components/ui/carousel/index.ts";
import Autoplay from 'embla-carousel-autoplay'
import { WheelGesturesPlugin } from 'embla-carousel-wheel-gestures'
import { type CarouselAPI } from "$lib/components/ui/carousel/context.ts";
import { getMediaType } from "$lib/utilities";

const plugin = Autoplay({ delay: 3000, stopOnInteraction: true })

export let items: string[] = [];
export let showSlideNumbers: boolean = true;

let api: CarouselAPI;
let count = 0;
let current = 0;
$: if (api) {
  count = api.scrollSnapList().length;
  current = api.selectedScrollSnap() + 1;
  api.on("select", () => {
    current = api.selectedScrollSnap() + 1;
  });
}
</script>


<Carousel.Root
bind:api={api}
class="mx-auto p-0"
opts={{loop: true}}
plugins={[plugin, WheelGesturesPlugin({forceWheelAxis: "y"})]}
on:mousenter={plugin.stop}
on:mouseleave={() => { plugin.play(); plugin.reset(); }}>
  <Carousel.Content class="p-0 h-[30rem]">
    {#each items as item}
      <Carousel.Item>
        <Card.Root class="flex h-full items-center p-0 !bg-neutral-950 border-neutral-800 justify-center">
          <Card.Content class="p-4 flex justify-center rounded-lg items-center">
            {#if getMediaType(item) === 'image'}
              <img src={item} alt="media" class="pointer-events-none max-h-96 !w-auto mx-auto" />
            {:else if getMediaType(item) === 'video'}
              <video class="pointer-events-none max-h-96 !w-auto mx-auto" autoPlay={true} muted={true} loop={true}>
                <source src={item} type={`video/${item.split('.').pop()}`}/>
              </video>
            {:else}
              <p>Unsupported media type</p>
            {/if}
          </Card.Content>
        </Card.Root>
      </Carousel.Item>
    {/each}
  </Carousel.Content>
  <Carousel.Previous />
  <Carousel.Next />
  {#if showSlideNumbers}
    <div class="py-2 text-center text-sm text-neutral-600 hover:text-neutral-400 transition-colors duration-300">
      Slide {current} of {count}
    </div>
  {/if}
</Carousel.Root>